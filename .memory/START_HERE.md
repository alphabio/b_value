 <!-- DO NOT EDIT THIS FILE WITHOUT CONSULTING AUTHOR -->
# START_HERE.md

**CRITICAL**: This file contains ONLY timeless instructions. NO status. NO progress tracking. NO session-specific content.

## What is b_value?

Bidirectional CSS value parser. Parse CSS → IR, generate IR → CSS. Type-safe, spec-compliant.

**Scope**: Individual property values ONLY. Not shorthands.

## Every Session - Same Pattern

```bash
# 1. Create your session archive FIRST
mkdir -p .memory/archive/$(date +%Y-%m-%d)-[topic]/

# 2. Archive INDEX.md to your new session directory
cp .memory/archive/INDEX.md .memory/archive/$(date +%Y-%m-%d)-[topic]/INDEX_ARCHIVED.md

# 3. Verify baseline
just check && just test

# 4. Work, commit frequently

# 5. Create HANDOVER.md in your archive at session end

# 6. Update INDEX.md to point to your session and add Archive Trail entry

# 7. Final commit
```

**ALL session artifacts go in the dated archive directory.**

## Quality Gates (MUST PASS)

```bash
just check   # Format, auto-fix, typecheck
just test    # All tests
```

Everything green before commit. No exceptions.

## Core Principles - NEVER VIOLATE

### DRY - Don't Repeat Yourself

**Rule**: If you write the same logic twice, extract it to `src/utils/`.

**Check**: Search for duplicate function implementations. If count > 1, extract it.

**Example**: 7 parsers had `parseAlpha()`. Fixed: `src/utils/parse/color-components.ts`.

### KISS - Keep It Simple

**Rule**: Code readable in 30 seconds. One function = one job.

**Check**: Can you explain it to a junior dev in 2 minutes? If no, simplify.

### Import from Core

**Rule**: NEVER hardcode units/keywords/types.

```typescript
✅ import { ABSOLUTE_LENGTH_UNITS } from "@/core/units";
❌ const units = ["px", "em", "rem"];
```

### TypeScript Strict

**Rule**: No `any`. No `@ts-ignore`. No `@ts-expect-error`.

Handle `undefined`. Validate before use. See `tsconfig.json`.

### Library Scope

**Rule**: b_value = individual values. b_short = shorthands.

```typescript
✅ Parse "rgb(255,0,0)" → { kind: "rgb", r: 255, g: 0, b: 0 }
❌ Expand "background: red" → "background-color: red"
```

## Project Structure

```
src/
├── core/        # Import types/units/keywords from here
├── parse/       # CSS → IR parsers
├── generate/    # IR → CSS generators
└── utils/       # Extract duplication here
    ├── ast/
    ├── parse/
    └── generate/
```

## Navigation - Where Is Everything?

**Start here**: `.memory/archive/INDEX.md` - Shows active phase and last session
- Archive INDEX.md to your session directory at start
- Create new INDEX.md pointing to your session
- Add entry to Archive Trail at end

**Code**: `src/` (self-documenting JSDoc)

**Archives**: `.memory/archive/YYYY-MM-DD-[topic]/` - Find examples:
- HANDOVER.md files for session outcomes
- ACTION_PLAN.md files for roadmaps
- CHECKPOINT_REVIEW.md files for DRY analyses

## Common Patterns

**Add parser**:
1. Check `src/utils/parse/` for reusable logic
2. Follow `src/parse/color/rgb.ts` pattern
3. Co-locate test: `[name].test.ts`
4. Verify round-trip: Parse → Generate → Parse (result equals input)
5. Add integration test in `test/integration/`

**Refactor duplication**:
1. `grep -r "function name"` to find copies
2. Extract to `src/utils/[parse|generate]/`
3. Add utility tests
4. Replace usage one file at a time
5. Test after each change
6. Commit frequently

**Debug failure**:
1. `just check && just test`
2. Read test name (descriptive)
3. Check diff (actual vs expected)
4. `git log --oneline -10` (recent changes)
5. Look for similar code in `src/utils/`

## Update Rules

**Update START_HERE.md ONLY IF**:
- Core principles changed
- Quality requirements changed
- Project structure changed
- Navigation pattern changed

**NEVER update for**:
- ❌ Test counts
- ❌ Session progress
- ❌ "Next: Session N"
- ❌ Status updates
- ❌ Recent activity

**All status goes in**: `HANDOVER.md` files in session archives.

## Import Aliases

Defined in `tsconfig.json`:
- `@/core/*` - Types, units, keywords
- `@/utils/*` - Shared utilities
- `@/parse/*` - Parsers
- `@/generate/*` - Generators

## Testing

```bash
pnpm test              # All tests
pnpm test -- rgb       # Filter by pattern (matches file names and test descriptions)
pnpm test -- --watch   # Watch mode
```

Tests co-located with source. Integration tests in `test/integration/`.

Round-trip pattern: Parse → Generate → Parse, verify result equals input.

---

**DRY and KISS are requirements, not suggestions. Keep the codebase honest.**
